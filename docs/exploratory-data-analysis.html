<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Section 2 Exploratory Data Analysis | Proteomics Data Analysis in R/Bioconductor</title>
<meta name="author" content="Tyler Sagendorf">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Proteomics Data Analysis in R/Bioconductor</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="isobaric-quantification-pipelines.html"><span class="header-section-number">1</span> Isobaric Quantification Pipelines</a></li>
<li><a class="active" href="exploratory-data-analysis.html"><span class="header-section-number">2</span> Exploratory Data Analysis</a></li>
<li><a class="" href="DEA.html"><span class="header-section-number">3</span> Differential Expression Analysis</a></li>
<li><a class="" href="pathway-analysis.html"><span class="header-section-number">4</span> Pathway Analysis</a></li>
<li><a class="" href="references-2.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PNNL-Comp-Mass-Spec/proteomics-data-analysis-tutorial">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="exploratory-data-analysis" class="section level1" number="2">
<h1>
<span class="header-section-number">Section 2</span> Exploratory Data Analysis<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis"><i class="fas fa-link"></i></a>
</h1>
<!---
TODO:
* What is exploratory data analysis? Explain.
--->
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">MSnSet.utils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>

<span class="co"># Set the theme for all plots. Base text size is set to 14 pts.</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Load the MSnSet</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">cptac_oca</span><span class="op">)</span></code></pre></div>
<div id="count-features-in-samples" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Count Features in Samples<a class="anchor" aria-label="anchor" href="#count-features-in-samples"><i class="fas fa-link"></i></a>
</h2>
<p>To count the number of features identified in each sample, we use <code>colSums</code> to tally the number of entries that are not <code>NA</code>.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the number of proteins </span>
<span class="co"># identified (not NA) in each sample</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">pData</span><span class="op">(</span><span class="va">oca.set</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>num_proteins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">oca.set</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># For the lollipop plot, it is best to sort num_peptides</span>
  <span class="co"># and preserve the ordering by converting the sample names</span>
  <span class="co"># to a factor. This is how we can specify the order of categorical</span>
  <span class="co"># variables in plots.</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">num_proteins</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sample_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
         sample_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sample_name</span>, levels <span class="op">=</span> <span class="va">sample_name</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Could also be accomplished with</span>
<span class="co"># oca.set$num_proteins = colSums(!is.na(exprs(oca.set)))</span>
<span class="co"># but we need to change the ordering for the lollipop plot</span></code></pre></div>
<p>Three methods of visualizing this information are presented below. We begin with the lollipop plot.</p>
<div id="lollipop-plot" class="section level3" number="2.1.1">
<h3>
<span class="header-section-number">2.1.1</span> Lollipop Plot<a class="anchor" aria-label="anchor" href="#lollipop-plot"><i class="fas fa-link"></i></a>
</h3>
<p>Lollipop plots are similar to bar graphs, but they are composed of line segments terminating in points. They are a good alternative to bar graphs because they better minimize the amount of non-data ink. This doesn’t matter too much when figures are only made for digital media, but it still reduces the visual clutter that comes with bars; however, it is not a good alternative to stacked bar graphs. In ggplot, we can construct lollipop plots by combining a <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment()</a></code> and a <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> layer.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Lollipop plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">num_proteins</span>, 
                   y <span class="op">=</span> <span class="va">sample_name</span>, yend <span class="op">=</span> <span class="va">sample_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">num_proteins</span>, y <span class="op">=</span> <span class="va">sample_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Number of Proteins Detected"</span>, 
                     <span class="co"># Remove space between data and y axis </span>
                     <span class="co"># (start lines at x = 0)</span>
                     expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Remove unnecessary y-axis title and the major y-axis grid lines</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="EDA_files/figure-html/num_protein_lollipop-1.png" width="75%" style="display: block; margin: auto;"></div>
<p>In this case, using a lollipop plot is not a very good use of space. Notice that the plot is lengthened so that all of the sample names are readable, and the number of proteins detected in each is about the same; a lot of the space is just taken up by lines. In this case, it would be better to use a table or another plot type like a boxplot.</p>
</div>
<div id="boxplot" class="section level3" number="2.1.2">
<h3>
<span class="header-section-number">2.1.2</span> Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"><i class="fas fa-link"></i></a>
</h3>
<p>A boxplot is good for identifying and labeling potential outliers, but it is limited to displaying a summary of the data. We will be using <code><a href="https://rdrr.io/r/graphics/boxplot.html">graphics::boxplot()</a></code> for this example, rather than the ggplot2 equivalent, because it is easier and the y-axis is uncluttered.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Boxplot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">num_proteins</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,
        xlab <span class="op">=</span> <span class="st">"Number of Proteins Detected"</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="EDA_files/figure-html/num_protein_boxplot-1.png" width="75%" style="display: block; margin: auto;"></div>
<p>Notice that the boxplot takes up a lot less space, but it is less informative because we can not directly compare samples. Also, we lose a lot of the fine details of the shape of the distribution. To address the latter point, we can instead use a density plot.</p>
</div>
<div id="density-plot" class="section level3" number="2.1.3">
<h3>
<span class="header-section-number">2.1.3</span> Density Plot<a class="anchor" aria-label="anchor" href="#density-plot"><i class="fas fa-link"></i></a>
</h3>
<p>A density plot is like a smoothed histogram. In fact, one of the benefits over the histogram is that we don’t have to deal with bins, as the choice of the number of bins can drastically change the overall shape of a histogram.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">num_proteins</span><span class="op">)</span>, 
               <span class="co"># Change fill color, make it translucent, remove outline</span>
               fill <span class="op">=</span> <span class="st">"lightblue"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Number of Proteins Detected"</span>, 
                     <span class="co"># Remove space between data and y axis</span>
                     expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">7800</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">6600</span>, <span class="fl">7800</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Density"</span>,
                     <span class="co"># Remove space between data and x axis (start y axis at 0)</span>
                     expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,
                     <span class="co"># Use scientific notation for labels</span>
                     labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_scientific.html">label_scientific</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Adjust plot margin so that the 7800 label is not cut off</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">16</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="EDA_files/figure-html/num_protein_density-1.png" width="75%" style="display: block; margin: auto;"></div>
<p>While outliers in a boxplot appear as points beyond the whiskers, outliers in density plots will appear as small bumps in the tails of the distribution.
While there are no outliers, in this case, we can see that there are two peaks where the number of identified proteins are concentrated. This is not something that could be captured with a boxplot, so it is useful to try different plot types.</p>
</div>
</div>
<div id="estimate-blood-contamination" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Estimate Blood Contamination<a class="anchor" aria-label="anchor" href="#estimate-blood-contamination"><i class="fas fa-link"></i></a>
</h2>
<!---
TODO:
* What are the major blood proteins?

* Hemoglobin alpha, beta, delta, gamma 1; fibrinogen alpha, beta, gamma; albumin, spectrin, 
--->
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># NOTE: eval set to FALSE</span>
<span class="va">blood_proteins</span> <span class="op">&lt;-</span> <span class="st">"HBA_HUMAN HBB_HUMAN HBD_HUMAN HBG1_HUMAN FIBA_HUMAN
FIBB_HUMAN FIBG_HUMAN SPTB1_HUMAN THRB_HUMAN ALBU_HUMAN A1AG1_HUMAN
A1AG2_HUMAN CAH1_HUMAN GLPA_HUMAN GLPB_HUMAN GLPC_HUMAN"</span>

<span class="va">blood_proteins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\s|\\n"</span>, <span class="st">"\\|"</span>, <span class="va">blood_proteins</span><span class="op">)</span>

<span class="va">m1</span><span class="op">$</span><span class="va">blood_contamination</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu">exprs</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">blood_proteins</span>, <span class="fu">featureNames</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>,
        <span class="fl">2</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="pca" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> PCA<a class="anchor" aria-label="anchor" href="#pca"><i class="fas fa-link"></i></a>
</h2>
<div id="overview" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h3>
<p>This is the overview for PCA.</p>
</div>
<div id="pca-plots" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> PCA Plots<a class="anchor" aria-label="anchor" href="#pca-plots"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Default plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/MSnSet.utils/man/plot_pca_v1.html">plot_pca_v3</a></span><span class="op">(</span><span class="va">oca.set</span>, phenotype <span class="op">=</span> <span class="st">"SUBTYPE"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="EDA_files/figure-html/pca_plot_base-1.png" width="75%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># New legend title</span>
<span class="va">legend.title</span> <span class="op">&lt;-</span> <span class="st">"Subtype"</span>

<span class="fu"><a href="https://rdrr.io/pkg/MSnSet.utils/man/plot_pca_v1.html">plot_pca_v3</a></span><span class="op">(</span><span class="va">oca.set</span>, phenotype <span class="op">=</span> <span class="st">"SUBTYPE"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Change the titles of the point color and ellipse fill legends</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">legend.title</span><span class="op">)</span>,
         <span class="co"># Do not include this line if show.ellipse = FALSE</span>
         fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">legend.title</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># Change base text size. theme_set() does not work here</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span id="fig:pca-plot-pretty"></span>
<img src="EDA_files/figure-html/pca-plot-pretty-1.png" alt="This is the figure caption" width="75%"><p class="caption">
Figure 2.1: This is the figure caption
</p>
</div>
<p>I am referencing Figure <a href="exploratory-data-analysis.html#fig:pca-plot-pretty">2.1</a>.</p>
</div>
<div id="list-top-contributing-features" class="section level3" number="2.3.3">
<h3>
<span class="header-section-number">2.3.3</span> List Top-Contributing Features<a class="anchor" aria-label="anchor" href="#list-top-contributing-features"><i class="fas fa-link"></i></a>
</h3>
<p>In MSnSet.utils, there is a function that allows us to determine which features contribute the most to each principal component. This is the main part of the code to do this.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># V is the matrix of eigenvectors that have been scaled to unit vectors.</span>
<span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">V</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Subset to values at least equal to the cutoff in magnitude</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">w</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">cutoff</span><span class="op">)</span><span class="op">]</span>
    <span class="co"># Order this subset by magnitude</span>
    <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>
  <span class="op">}</span><span class="op">)</span></code></pre></div>
<!-- ## UMAP -->
<!-- ### Overview -->
<!-- Uniform Manifold Approximation and Projection (UMAP) is another dimensionality reduction technique "that can be used for visualization similarly to t-SNE" or for "general non-linear dimension reduction" ([https://umap-learn.readthedocs.io/en/latest/index.html](https://umap-learn.readthedocs.io/en/latest/index.html)). In comparison to t-SNE, UMAP boasts a "superior runtime" and "arguably preserves more of the global structure" of the high-dimensional data ([https://arxiv.org/abs/1802.03426](https://arxiv.org/abs/1802.03426)). -->
<!-- The two main UMAP hyperparameters that we should keep in mind are `n_neighbors` and `min_dist`. The former "controls how UMAP balances local versus global structure in the data," with low values causing UMAP to "concentrate on very local structure[s]" and high values leading to a loss of the "fine detail structure" in favor of a broader view of the data ([https://umap-learn.readthedocs.io/en/latest/parameters.html](https://umap-learn.readthedocs.io/en/latest/parameters.html)). When making UMAP plots, it is a good idea to try different values of `n_neighbors`. The other parameter, `min_dist`, determines the distance between a point and their nearest neighbor in the embedding. It is more of a graphical parameter, with smaller values producing denser clusters. -->
<!-- For more details on UMAP, please check out the [documentation](https://umap-learn.readthedocs.io/en/latest/index.html) by Leland McInnes (first author of the original UMAP paper)[.](https://umap-learn.readthedocs.io/en/latest/index.html) For an overview of t-SNE, please check out the [openTSNE](https://opentsne.readthedocs.io/en/latest/index.html) documentation. -->
<!-- ### Comparison with PCA -->
<!-- While PCA is faster than UMAP and requires no hyperparameter tuning, it is limited to defining linear relationships between predictors, and it is sensitive to the presence of outliers; in contrast, UMAP is non-linear and can actually be [used in conjunction with outlier detection methods](https://umap-learn.readthedocs.io/en/latest/outliers.html). -->
<!-- ### UMAP Scatterplots -->
<!-- The MSnSet.utils package provides a wrapper function around `umap::umap()` called `plot_umap()` that allows us to construct scatterplots from an MSnSet object. In these plots, the points are samples, and the UMAP components are constructed from the features. The default value of `n_neighbors` is the nearest integer to the square root of the number of samples while the default `min_dist` is 0.1 (nearest neighbors will be 0.1 units apart). -->
<!-- We will use `cptac_oca` for this example. First, we will take a look at the base UMAP plot of the samples. In this plot, points are not colored by a column in `pData(oca.set)`. Since there is a degree of randomness in the UMAP algorithm, it is a good idea to set the seed. There is an argument called `random_state` that allows us to do this. -->
<!-- ```{r umap_base} -->
<!-- library(MSnSet.utils) -->
<!-- # Load the MSnSet -->
<!-- data(cptac_oca) -->
<!-- # Base UMAP scatterplot of samples -->
<!-- plot_umap(oca.set, random_state = 99) -->
<!-- ``` -->
<!-- ```{r umap_color} -->
<!-- plot_umap(oca.set, phenotype = "SUBTYPE", random_state = 99) -->
<!-- ``` -->
<!-- We can also look at plots for other values of `n_neighbors`. We will make plots for 6, 9, 15, and 30 nearest neighbors. -->
<!-- ```{r umap_mult_k} -->
<!-- # Different number of nearest neighbors to try -->
<!-- k <- c(6, 9, 15, 30) -->
<!-- # UMAP plot for each value of k -->
<!-- plot_umap(oca.set, phenotype = "SUBTYPE",  -->
<!--           n_neighbors = k, random_state = 99) -->
<!-- ``` -->
<!-- Below is the same figure with some improvements to the appearance. -->
<!-- ```{r umap_mult_k_pretty, fig.height=4, fig.asp=1.1} -->
<!-- # Customize facet labels -->
<!-- facet_labs <- paste("k =", k) -->
<!-- names(facet_labs) <- k -->
<!-- plot_umap(oca.set, phenotype = "SUBTYPE",  -->
<!--           n_neighbors = k, random_state = 99, -->
<!--           # argument passed to facet_wrap: -->
<!--           labeller = labeller(n_neighbors = facet_labs)) + -->
<!--   ggtitle("UMAP Plots for Different Nearest Neighbors") + -->
<!--   # Change legend titles for the point color and ellipse fill. -->
<!--   guides(color = guide_legend(title = "Subtype"), -->
<!--          fill = guide_legend(title = "Subtype")) + -->
<!--   # Customize the facets and legend layout -->
<!--   theme( -->
<!--     # Move the legend to the bottom and  -->
<!--     # arrange labels horizontally -->
<!--     legend.position = "bottom",  -->
<!--     legend.direction = "horizontal",  -->
<!--     # Remove the facet label background and  -->
<!--     # increase label size relative to the -->
<!--     # base text size of the theme. -->
<!--     strip.background = element_blank(), -->
<!--     strip.text = element_text(size = rel(1.1)) -->
<!--   ) -->
<!-- ``` -->

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="isobaric-quantification-pipelines.html"><span class="header-section-number">1</span> Isobaric Quantification Pipelines</a></div>
<div class="next"><a href="DEA.html"><span class="header-section-number">3</span> Differential Expression Analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#exploratory-data-analysis"><span class="header-section-number">2</span> Exploratory Data Analysis</a></li>
<li>
<a class="nav-link" href="#count-features-in-samples"><span class="header-section-number">2.1</span> Count Features in Samples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#lollipop-plot"><span class="header-section-number">2.1.1</span> Lollipop Plot</a></li>
<li><a class="nav-link" href="#boxplot"><span class="header-section-number">2.1.2</span> Boxplot</a></li>
<li><a class="nav-link" href="#density-plot"><span class="header-section-number">2.1.3</span> Density Plot</a></li>
</ul>
</li>
<li><a class="nav-link" href="#estimate-blood-contamination"><span class="header-section-number">2.2</span> Estimate Blood Contamination</a></li>
<li>
<a class="nav-link" href="#pca"><span class="header-section-number">2.3</span> PCA</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#overview"><span class="header-section-number">2.3.1</span> Overview</a></li>
<li><a class="nav-link" href="#pca-plots"><span class="header-section-number">2.3.2</span> PCA Plots</a></li>
<li><a class="nav-link" href="#list-top-contributing-features"><span class="header-section-number">2.3.3</span> List Top-Contributing Features</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PNNL-Comp-Mass-Spec/proteomics-data-analysis-tutorial/blob/master/EDA.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PNNL-Comp-Mass-Spec/proteomics-data-analysis-tutorial/edit/master/EDA.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Proteomics Data Analysis in R/Bioconductor</strong>" was written by Tyler Sagendorf. It was last built on October 17, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
